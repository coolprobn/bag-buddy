<div data-controller="mobile-menu">
  <!-- Desktop Top Navigation -->
  <nav class="bg-primary-600 text-white shadow-lg sticky top-0 z-50 hidden md:block">
    <div class="max-w-7xl mx-auto px-4 py-4">
      <div class="flex items-center">
        <!-- Left: Logo -->
        <div class="flex-shrink-0">
          <%= link_to dashboard_path, class: "flex items-center group" do %>
            <div class="h-10 w-10 rounded-full overflow-hidden bg-white flex items-center justify-center shadow-md hover:shadow-lg transition-all duration-200 border-2 border-white/20 hover:border-white/40">
              <%= image_tag "logo.jpg", alt: "Bag Buddy", class: "h-full w-full object-cover" %>
            </div>
          <% end %>
        </div>
        
        <!-- Center: Menu Items -->
        <div class="flex-1 flex items-center justify-center space-x-4">
          <% nav_items.each do |item| %>
            <%= link_to item[:path], 
                  class: "text-sm hover:text-primary-200 transition-colors #{'text-primary-200 font-semibold' if active?(item[:path])}" do %>
              <span class="mr-1"><%= item[:icon] %></span>
              <%= item[:name] %>
            <% end %>
          <% end %>
          
          <!-- Dropdown Menu -->
          <div class="relative group" data-controller="dropdown">
            <button class="text-sm hover:text-primary-200 transition-colors flex items-center" data-action="click->dropdown#toggle">
              <span class="mr-1">☰</span>
              More
              <svg class="ml-1 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
            <div class="absolute left-0 mt-2 w-64 bg-white rounded-lg shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50 border border-secondary-200" data-dropdown-target="menu">
              <div class="py-2">
                <% dropdown_items.each do |group| %>
                  <div class="px-4 py-2 text-xs font-semibold text-secondary-500 uppercase tracking-wider">
                    <%= group[:group] %>
                  </div>
                  <% group[:items].each do |item| %>
                    <%= link_to item[:path], 
                          class: "flex items-center px-4 py-2 text-sm text-primary-900 hover:bg-secondary-100 transition-colors #{'bg-secondary-100 font-semibold' if active?(item[:path])}" do %>
                      <span class="mr-2"><%= item[:icon] %></span>
                      <%= item[:name] %>
                    <% end %>
                  <% end %>
                  <% unless group == dropdown_items.last %>
                    <div class="border-t border-secondary-200 my-1"></div>
                  <% end %>
                <% end %>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Right: User Info -->
        <div class="flex-shrink-0 flex items-center space-x-4">
          <%= link_to profile_path, class: "text-sm hover:text-primary-200 transition-colors" do %>
            <%= current_user.full_name %>
          <% end %>
          <%= render Buttons::PrimaryComponent.new(
                href: destroy_user_session_path,
                method: :delete,
                size: :sm,
                class: "bg-primary-700 hover:bg-primary-800"
              ) do %>
            Logout
          <% end %>
        </div>
      </div>
    </div>
  </nav>

  <!-- Mobile Top Bar (Minimal) -->
  <div class="md:hidden bg-primary-600 text-white shadow-lg sticky top-0 z-50">
    <div class="px-4 py-3 flex items-center justify-between">
      <%= link_to dashboard_path, class: "flex items-center group" do %>
        <div class="h-8 w-8 rounded-full overflow-hidden bg-white flex items-center justify-center shadow-md border-2 border-white/20">
          <%= image_tag "logo.jpg", alt: "Bag Buddy", class: "h-full w-full object-cover" %>
        </div>
      <% end %>
      <div class="flex items-center space-x-3">
        <%= link_to profile_path, class: "text-xs hover:text-primary-200 transition-colors" do %>
          <%= current_user.first_name %>
        <% end %>
        <%= link_to destroy_user_session_path, method: :delete, class: "text-sm px-3 py-1 bg-primary-700 rounded" do %>
          Logout
        <% end %>
      </div>
    </div>
  </div>

  <!-- Mobile Bottom Navigation -->
  <nav class="md:hidden fixed bottom-0 left-0 right-0 bg-white border-t border-secondary-200 shadow-lg z-50 safe-area-bottom">
    <div class="grid grid-cols-5 gap-1">
      <% main_nav_items.each do |item| %>
        <% if item[:name] == "More" %>
          <button 
            type="button"
            class="flex flex-col items-center justify-center py-2 px-1 text-xs transition-colors cursor-pointer touch-manipulation #{'text-primary-600' if active?(item[:path])} #{'text-secondary-600' unless active?(item[:path])}"
            data-action="click->mobile-menu#toggle touchstart->mobile-menu#toggle"
            data-mobile-menu-target="trigger">
            <span class="text-2xl mb-1 pointer-events-none"><%= item[:icon] %></span>
            <span class="font-medium pointer-events-none"><%= item[:name] %></span>
          </button>
        <% else %>
          <%= link_to item[:path], 
                class: "flex flex-col items-center justify-center py-2 px-1 text-xs transition-colors #{'text-primary-600' if active?(item[:path])} #{'text-secondary-600' unless active?(item[:path])}" do %>
            <span class="text-2xl mb-1"><%= item[:icon] %></span>
            <span class="font-medium"><%= item[:name] %></span>
          <% end %>
        <% end %>
      <% end %>
    </div>
  </nav>

  <!-- Mobile More Menu Overlay -->
  <div 
    class="hidden fixed inset-0 bg-black bg-opacity-50 z-[60] md:hidden"
    data-mobile-menu-target="overlay"
    data-action="click->mobile-menu#closeOnOverlayClick">
  </div>

  <!-- Mobile More Menu Slide-out -->
  <div 
    class="fixed top-0 right-0 h-full w-80 bg-white shadow-xl z-[70] transform translate-x-full transition-transform duration-300 ease-in-out md:hidden safe-area-top"
    data-mobile-menu-target="menu">
    <div class="flex flex-col h-full">
      <!-- Header -->
      <div class="flex items-center justify-between p-4 border-b border-secondary-200 bg-primary-600 text-white">
        <h2 class="text-lg font-semibold">More</h2>
        <button 
          type="button"
          class="text-white hover:text-primary-200 transition-colors"
          data-action="click->mobile-menu#close">
          ✕
        </button>
      </div>
      
      <!-- Menu Items -->
      <div class="flex-1 overflow-y-auto">
        <% dropdown_items.each do |group| %>
          <div class="px-4 py-3 border-b border-secondary-100">
            <div class="text-xs font-semibold text-secondary-500 uppercase tracking-wider mb-2">
              <%= group[:group] %>
            </div>
            <div class="space-y-1">
              <% group[:items].each do |item| %>
                <%= link_to item[:path], 
                      class: "flex items-center px-3 py-3 rounded-lg text-sm text-primary-900 hover:bg-secondary-100 transition-colors #{'bg-secondary-100 font-semibold' if active?(item[:path])}",
                      data: { action: "click->mobile-menu#close" } do %>
                  <span class="mr-3 text-xl"><%= item[:icon] %></span>
                  <span><%= item[:name] %></span>
                <% end %>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
