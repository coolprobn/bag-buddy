<div class="min-h-screen bg-secondary-50">
  <div class="max-w-4xl mx-auto">
    <div class="mb-6 flex items-center justify-between">
      <div>
        <h1 class="text-3xl font-bold text-primary-900 mb-2">Exchange Details</h1>
        <p class="text-secondary-600">Exchange #<%= @exchange.obfuscated_id %></p>
      </div>
      <%= render Buttons::PrimaryComponent.new(href: edit_exchange_path(@exchange)) do %>
        Edit Exchange
      <% end %>
    </div>

    <%= link_to "â† Back to Exchanges", exchanges_path, 
        class: "text-primary-600 hover:text-primary-700 font-medium mb-6 inline-block" %>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- Exchange Information -->
      <%= render CardComponent.new(title: "Exchange Information") do %>
        <dl class="space-y-4">
          <div>
            <dt class="text-sm font-medium text-secondary-600">Date</dt>
            <dd class="mt-1 text-lg text-primary-900"><%= l(@exchange.created_at, format: :long) %></dd>
          </div>

          <div>
            <dt class="text-sm font-medium text-secondary-600">Original Sale</dt>
            <dd class="mt-1 text-primary-900">
              <%= link_to "Sale ##{@exchange.original_sale.obfuscated_id}", sale_path(@exchange.original_sale), 
                  class: "text-primary-600 hover:text-primary-700 underline" %>
            </dd>
          </div>

          <div>
            <dt class="text-sm font-medium text-secondary-600">Original Product</dt>
            <dd class="mt-1 text-primary-900">
              <%= link_to @exchange.original_sale.product.name, product_path(@exchange.original_sale.product), 
                  class: "text-primary-600 hover:text-primary-700 underline" %>
            </dd>
            <dd class="mt-1 text-sm text-secondary-600">
              Price: Rs. <%= number_with_delimiter(@exchange.original_sale.selling_price) %>
            </dd>
          </div>

          <div>
            <dt class="text-sm font-medium text-secondary-600">Replacement Product</dt>
            <dd class="mt-1 text-primary-900">
              <%= link_to @exchange.replacement_product.name, product_path(@exchange.replacement_product), 
                  class: "text-primary-600 hover:text-primary-700 underline" %>
            </dd>
            <dd class="mt-1 text-sm text-secondary-600">
              Suggested Price: Rs. <%= number_with_delimiter(@exchange.replacement_product.auto_suggested_selling_price || @exchange.replacement_product.current_cost_price * 1.5) %>
            </dd>
          </div>

          <div>
            <dt class="text-sm font-medium text-secondary-600">Price Difference</dt>
            <dd class="mt-1 text-2xl font-bold <%= @exchange.price_difference >= 0 ? 'text-green-600' : 'text-red-600' %>">
              <% if @exchange.price_difference.present? %>
                <%= @exchange.price_difference >= 0 ? '+' : '' %>Rs. <%= number_with_delimiter(@exchange.price_difference) %>
              <% else %>
                <span class="text-secondary-500">Not calculated</span>
              <% end %>
            </dd>
            <dd class="mt-1 text-sm text-secondary-600">
              <% if @exchange.price_difference.present? %>
                <% if @exchange.price_difference >= 0 %>
                  Customer pays additional amount
                <% else %>
                  Refund to customer
                <% end %>
              <% end %>
            </dd>
          </div>

          <% if @exchange.notes.present? %>
            <div>
              <dt class="text-sm font-medium text-secondary-600">Notes</dt>
              <dd class="mt-1 text-primary-900 whitespace-pre-wrap"><%= @exchange.notes %></dd>
            </div>
          <% end %>
        </dl>
      <% end %>

      <!-- Original Sale Details -->
      <%= render CardComponent.new(title: "Original Sale Details") do %>
        <dl class="space-y-4">
          <div>
            <dt class="text-sm font-medium text-secondary-600">Customer</dt>
            <dd class="mt-1 text-primary-900">
              <%= link_to @exchange.original_sale.customer.full_name, customer_path(@exchange.original_sale.customer), 
                  class: "text-primary-600 hover:text-primary-700 underline" %>
            </dd>
          </div>

          <div>
            <dt class="text-sm font-medium text-secondary-600">Sale Date</dt>
            <dd class="mt-1 text-primary-900"><%= l(@exchange.original_sale.created_at.to_date, format: :long) %></dd>
          </div>

          <div>
            <dt class="text-sm font-medium text-secondary-600">Quantity</dt>
            <dd class="mt-1 text-primary-900"><%= @exchange.original_sale.quantity %></dd>
          </div>

          <div>
            <dt class="text-sm font-medium text-secondary-600">Total Sale Amount</dt>
            <dd class="mt-1 text-primary-900">Rs. <%= number_with_delimiter(@exchange.original_sale.total) %></dd>
          </div>

          <div>
            <dt class="text-sm font-medium text-secondary-600">Payment Method</dt>
            <dd class="mt-1">
              <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-primary-100 text-primary-800">
                <%= @exchange.original_sale.payment_method.humanize %>
              </span>
            </dd>
          </div>
        </dl>
      <% end %>
    </div>
  </div>
</div>

